---
title: "Test"
author: "Patrick Lac"
date: "April 24, 2020"
output: 
  html_document: 
    keep_md: yes
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, warning = F)
```

``` {r library, message = F}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(ggpubr)
library(cowplot)
library(gridExtra)
```

Let's begin by importing our data:

``` {r import.data}
Test_metadata <- read.csv("F:/Git/PLac Analyses/miR-532 project/miR-532/Peripheral bleeds/Data/Test_MetaData.csv")
JL_data <- read.csv("F:/Git/PLac Analyses/miR-532 project/miR-532/Peripheral bleeds/Data/JL_532_BMT_Data.csv")
Test_MB_data <- read.csv("F:/Git/PLac Analyses/miR-532 project/miR-532/Peripheral bleeds/Data/Test_MB_532_BMT_Data.csv")
PL_data <- read.csv("F:/Git/PLac Analyses/miR-532 project/miR-532/Peripheral bleeds/Data/PL_532_BMT_Data.csv")
```

Next lets attach the different peripheral blood data together:
``` {r combine.data}
Total_PB_data <- rbind(JL_data, Test_MB_data, PL_data)
head(Total_PB_data)
```

We will make a copy of the total data for manipulation:
``` {r data.copy}
Data.copy <- Total_PB_data
```

# Peripheral bleeds 11 weeks post-transplant:
Next we will filter for CBC data at 11 weeks post-transplant
``` {r filter.11weeks}
week10data <- subset(Data.copy, Weeks.post.transplant == 10)
week11data <- subset(Data.copy, Weeks.post.transplant == 11)
Data.sub <- rbind(week10data, week11data)
head(Data.sub)
```

## Now lets separate the data based on the transplanter:

We begin by joining the metadata to the week 11 CBC data
``` {r data+metadata}
alldata.sub <- left_join(Test_metadata, Data.sub)

all.control <- subset(alldata.sub, Treatment == "control")
all.miR532 <-subset(alldata.sub, Treatment == "miR-532")
```

Now let's make dot plots for the CBC data by transplanter
``` {r transplanter.WBC, fig.width=4, fig.height=4}


transplanter.WBC.control <- ggplot(all.control, aes(x=Transplant.performed.by., y=WBC, fill=Transplant.performed.by.)) +
  stat_summary(fun.data=mean_sdl, fun.args=list(mult=1), binwidth = 0.1, geom="errorbar", color="black", size=1.2, width=0.1) +
  stat_summary(fun.y=mean, geom="crossbar", color="black", size=0.6, width=0.2) +
  geom_dotplot(binaxis="y", binwidth = 0.1, stackdir="center", stackratio=2, dotsize=3) + 
  ylim(0, 12) +
  labs(title = "White blood cells - Control", x = "Transplanter", y = "WBC (10"^"3"*"/"~mu~"L)") +
  theme(plot.title = element_text(hjust=0.5), text=element_text(size=11)) +
  scale_fill_discrete(name="Transplanter", labels = c("Jeff Lam (n=11)", "Marion van den Bosch (n=5)", "Patrick Lac (n=9)")) +
  stat_compare_means(comparisons = list(c("JL","PL"), c("MB","PL")), aes(label=..p..)) +
  theme(legend.position="top", legend.title=element_text(size=15), legend.text = element_text(size=15)) +
  theme(legend.position="none")


transplanter.WBC.control
```

``` {r pairwise_stats}
tukey.WBC <- aov(WBC ~ Transplant.performed.by., data=all.control) %>%
  TukeyHSD()
tukey.WBC
```