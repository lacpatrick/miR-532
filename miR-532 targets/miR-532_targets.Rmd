---
title: "miR-532 targets"
author: "Patrick Lac"
date: "April 25, 2020"
output: 
  html_document: 
    keep_md: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, warning = F)
```

```{r libraries}
library(tidyverse)
library(dplyr)
library(RobustRankAggreg)
```

```{r data}
AMLPMP_corrgenes <- read.csv("F:/Git/PLac Analyses/miR-532 project/miR-532/miR-532 targets/Data/Gene_corr_miR-532_AMLPMP.csv")
TCGA_corrgenes <- read.csv("F:/Git/PLac Analyses/miR-532 project/miR-532/miR-532 targets/Data/Gene_corr_miR-532_TCGA.csv")
```

Now let's prepare our list of genes for input into RankAggreg 

In rankAggreg, the algorithm looks at how each item is positioned in the ranked lists and compares this to the baseline case where the  lists are randomly shuffled. 

A P-value is calculated, showing how it is positioned in the aggregated list compared to chance. This P-value is used both for re-ranking the items and deciding their significance. (https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3278763/)


```{r downreg_genes}
AMLPMP_downreg <- filter(AMLPMP_corrgenes, AMLPMP_corrgenes$estimate < 0)
TCGA_downreg <- filter(TCGA_corrgenes, TCGA_corrgenes$estimate < 0)
```

``` {r common_genes}
AMLPMP_shared <- filter(AMLPMP_downreg, AMLPMP_downreg$ï..gene %in% TCGA_downreg$ï..gene)
TCGA_shared <- filter(TCGA_downreg, TCGA_downreg$ï..gene %in% AMLPMP_downreg$ï..gene)
```

From the entire list of significantly correlated genes, 146 and 139 genes are negatively correlated with miR-532 expression in the AML-PMP and TCGA datasets respectively. 116 are common between the datasets.

```{r lists}
AMLPMP_ordered <- AMLPMP_shared[order(AMLPMP_shared$neg_corr_rank),] %>%
  pull(var=1) %>%
  as.matrix(nrow=1)

TCGA_ordered<- TCGA_shared[order(TCGA_shared$neg_corr_rank),] %>%
  pull(var=1) %>%
  as.matrix(nrow=1)

AMLPMP_anticorr <- AMLPMP_ordered[1:116,1]
TCGA_anticorr <- TCGA_ordered[1:116,1]
```

``` {r aggregateranks}
glist <- list(AMLPMP_anticorr, TCGA_anticorr)
finalrank <- aggregateRanks(glist = glist)
finalrank

rank.stuart <- aggregateRanks(glist = glist, method= "RRA")
rank.stuart
```

``` {r aggregateranks}
glist <- list(AMLPMP_anticorr, TCGA_anticorr)
finalrank <- aggregateRanks(glist = glist)
finalrank

rank.stuart <- aggregateRanks(glist = glist, method= "stuart")
rank.stuart
```

Now let's convert the results into csv files:
``` {r csv}
write.csv(finalrank, file = "Aggregated_miR-532_targets(RRA).csv")
write.csv(rank.stuart, file = "Aggregated_miR-532_targets(Stuart).csv")
```

```{r RankAggreg}
RankAggreg_matrix <- matrix(c(AMLPMP_ordered[1:100],
              TCGA_ordered[1:100]), byrow=TRUE, ncol=100)

(CESnoweights <- RankAggreg(RankAggreg_matrix, 25, method="CE", distance="Spearman", N=100, convIn=5, rho=.1))
```